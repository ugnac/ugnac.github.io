# Java类加载过程

## 前言：

加载 -> 验证 -> 准备 -> 解析 -> 初始化



Java类加载过程是Java虚拟机（JVM）将.class文件中的字节码装载到内存中，并对字节码进行验证、准备和初始化的过程。这个过程涉及到了Java虚拟机的类加载器、运行时数据区等多个方面，其中包含了很多的细节和技术问题。

## 1、类加载器

Java虚拟机的类加载过程是由类加载器（`ClassLoader`）来实现的。

类加载器负责将类装载到内存中，并为其创建一个Class对象。

Java虚拟机定义了三种类加载器，分别为`Bootstrap ClassLoader`、`Extension ClassLoader`、`System ClassLoader`，它们按照层次关系进行组织，而且每个类加载器都有自己独立的命名空间，保证了不同类加载器之间的隔离性。

## 2、加载

类加载过程的第一阶段是**加载（Loading）**，即通过类加载器读取.class文件中的二进制字节流，并将其转换成Java虚拟机中的Class对象。在这个阶段，Java虚拟机将会检查类文件的格式、语义等内容，确保其符合Java规范，否则将抛出`ClassFormatError`等异常。

## 3、 验证

在加载完成后，Java虚拟机会对类进行验证（Verification），以确保它的字节码是正确、安全且符合规范的。这个阶段主要有四种验证方式：文件格式验证、元数据验证、字节码验证和符号引用验证。

## 4、准备

在验证通过后，Java虚拟机会为类分配内存空间，并进行默认初始化（Prepare），即将类变量分配内存并初始化为二进制零值。这个过程中不会涉及任何Java代码执行，只是简单地为类变量赋予一些初始值。

## 5、 解析

解析（Resolution）是Java虚拟机将符号引用替换为直接引用的过程。在Java程序中，调用方法或访问对象时通常使用符号引用，需要在运行时将其解析成直接引用才能执行相应的操作。

## 6、初始化阶段

当类被加载并初始化后，Java虚拟机会执行其静态初始化器（`clinit`）中的Java代码。静态初始化器包含了对类中所有静态变量进行赋值操作的Java代码块，它们按照类定义时的顺序依次执行。如果在静态初始化器中发生异常，则该类将被视为无法正确初始化，不允许被使用。



**类加载过程总结**

Java类加载过程是一个复杂的过程，它涉及到类加载器、运行时数据区等多个方面，并且在不同的阶段都需要完成各种任务，如文件格式验证、元数据验证、符号引用解析等。了解这些过程可以帮助Java开发者更好地理解Java虚拟机的内部实现机制，从而编写出更加高效和优秀的Java代码。